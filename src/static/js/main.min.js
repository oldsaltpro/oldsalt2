function getAverageRGB(){arguments[0].each(function(){var u=new Image,p=$(this);u.crossOrigin="anonymous",u.src=p.css("background-image").split('("')[1].split('")')[0],u.height=p.height(),u.width=p.width(),u.onload=function(){var e,a,t,o,i={r:65,g:65,b:65},n=document.createElement("canvas"),s=n.getContext&&n.getContext("2d"),r=-4,c=i,d=0;if(!s)return i;t=n.height=u.naturalHeight||u.offsetHeight||u.height,a=n.width=u.naturalWidth||u.offsetWidth||u.width,s.drawImage(u,390,270,470,450,0,0,t,a);try{e=s.getImageData(0,0,a,t)}catch(e){return console.log(e),i}for(o=e.data.length;(r+=160)<o&&(++d,c.r+=e.data[r],c.g+=e.data[r+1],c.b+=e.data[r+2],!((r+=160)<o)););c.r=~~Math.abs(c.r/d-50),c.g=~~Math.abs(c.g/d-50),c.b=~~Math.abs(c.b/d-50);var l="rgba("+c.r+", "+c.g+", "+c.b+", 0.4)";c.r,c.g,c.b;p.siblings(".da-overlay").css({"background-color":l})}})}!function(r){var n,s;function e(e){var a=n-e.offset().left-e.width()/2,t=s-e.offset().top-e.height()/2;console.log(a+","+t);var o=0<a?"r":"l",i=0<t?"b":"t";return Math.abs(a)>Math.abs(t)?o:i}skel.breakpoints({xlarge:"(max-width: 1680px)",large:"(max-width: 1280px)",medium:"(max-width: 980px)",small:"(max-width: 736px)",xsmall:"(max-width: 480px)"}),r(function(){var e,a=r(window),t=r("body");r("#wrapper");(skel.vars.IEVersion<12&&t.addClass("ie"),skel.vars.mobile&&t.addClass("touch"),skel.canUse("transition"))&&(t.addClass("loading"),a.on("load",function(){window.setTimeout(function(){t.removeClass("loading")},100)}),a.on("resize",function(){window.clearTimeout(e),t.addClass("resizing"),e=window.setTimeout(function(){t.removeClass("resizing")},100)}));a.scrollTop(0),r("form").placeholder();var o=r(".panel");o.each(function(){var a=r(this),e=r('[href="#'+a.attr("id")+'"]');r('<div class="closer" />').appendTo(a).on("click",function(e){a.trigger("---hide")}),a.on("click",function(e){e.stopPropagation()}).on("---toggle",function(){a.hasClass("active")?a.triggerHandler("---hide"):a.triggerHandler("---show")}).on("---show",function(){t.hasClass("content-active")&&o.trigger("---hide"),a.addClass("active"),e.addClass("active"),t.addClass("content-active")}).on("---hide",function(){a.removeClass("active"),e.removeClass("active"),t.removeClass("content-active")}),e.removeAttr("href").css("cursor","pointer").on("click",function(e){e.preventDefault(),e.stopPropagation(),a.trigger("---toggle")})}),t.on("click",function(e){t.hasClass("content-active")&&(e.preventDefault(),e.stopPropagation(),o.trigger("---hide"))}),a.on("keyup",function(e){27==e.keyCode&&t.hasClass("content-active")&&(e.preventDefault(),e.stopPropagation(),o.trigger("---hide"))}),r("#header").find("a").each(function(){var e=r(this),a=e.attr("href");a&&"#"!=a.charAt(0)&&e.removeAttr("href").css("cursor","pointer").on("click",function(e){e.preventDefault(),e.stopPropagation(),window.location.href=a})}),r("#footer").find(".copyright").each(function(){var e=r(this),a=e.parent(),t=a.parent().children().last();skel.on("+medium",function(){e.appendTo(t)}).on("-medium",function(){e.appendTo(a)})});var i=r("#main"),n={};function s(e){var a=function(e){var a={};void 0!==EXIF.getTag(e,"Model")&&(a.model=EXIF.getTag(e,"Model"));void 0!==EXIF.getTag(e,"FNumber")&&(a.aperture=EXIF.getTag(e,"FNumber"));void 0!==EXIF.getTag(e,"ExposureTime")&&(a.shutter_speed=EXIF.getTag(e,"ExposureTime"));void 0!==EXIF.getTag(e,"ISOSpeedRatings")&&(a.iso=EXIF.getTag(e,"ISOSpeedRatings"));return a}(e),t="";for(var o in a)"model"===o&&(t+='<i class="fa fa-camera-retro" aria-hidden="true"></i> '+a.model+"&nbsp;&nbsp;"),"aperture"===o&&(t+='<i class="fa fa-dot-circle-o" aria-hidden="true"></i> f/'+a.aperture+"&nbsp;&nbsp;"),"shutter_speed"===o&&(t+='<i class="fa fa-clock-o" aria-hidden="true"></i> '+a.shutter_speed+"&nbsp;&nbsp;"),"iso"===o&&(t+='<i class="fa fa-info-circle" aria-hidden="true"></i> '+a.iso+"&nbsp;&nbsp;");return t}i.children(".thumb").each(function(){var e,a=r(this),t=a.find(".image"),o=t.children("img");0!=t.length&&(t.css("background-image","url("+o.attr("src")+")"),(e=o.data("position"))&&t.css("background-position",e),skel.vars.IEVersion<11&&a.css("cursor","pointer").on("click",function(){t.trigger("click")}),EXIF.getData(o[0],function(){n[o.data("name")]=s(this)}))}),i.poptrox({baseZIndex:2e4,caption:function(e){var a=e.children("img"),t=n[a.data("name")];return void 0===t&&EXIF.getData(a[0],function(){t=n[a.data("name")]=s(this)}),void 0!==t?"<p>"+t+"</p>":" "},fadeSpeed:300,onPopupClose:function(){t.removeClass("modal-active")},onPopupOpen:function(){t.addClass("modal-active")},overlayOpacity:0,popupCloserText:"",popupHeight:100,popupLoaderText:"",popupSpeed:300,popupWidth:150,selector:".thumb > a.image",usePopupCaption:!0,usePopupCloser:!0,usePopupDefaultStyling:!1,usePopupForceClose:!0,usePopupLoader:!0,usePopupNav:!0,windowMargin:50}),skel.on("-xsmall",function(){i[0]._poptrox.windowMargin=50}).on("+xsmall",function(){i[0]._poptrox.windowMargin=0})}),r(document).mousemove(function(e){n=e.pageX,s=e.pageY}),r(".da-aware").mouseenter(function(){this.className=this.className.replace(/\w*-in(\b|$)/,""),this.className=this.className.replace(/\w*-out(\b|$)/,""),r(this).addClass(e(r(this))+"-in")}),r(".da-aware").mouseleave(function(){r(this).addClass(e(r(this))+"-out")})}(jQuery),getAverageRGB($("a.image")),console.log($("a.image").length);